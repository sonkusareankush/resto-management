"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3827],{3827:(q,f,u)=>{u.r(f),u.d(f,{Tab1PageModule:()=>X});var s=u(4742),_=u(177),d=u(4341),v=u(70),p=u(467),I=u(156);const b={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};var g,E=new Uint8Array(16);function P(){if(!g&&!(g=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return g(E)}for(var c=[],h=0;h<256;++h)c.push((h+256).toString(16).slice(1));const j=function w(o,a,i){if(b.randomUUID&&!a&&!o)return b.randomUUID();var e=(o=o||{}).random||(o.rng||P)();if(e[6]=15&e[6]|64,e[8]=63&e[8]|128,a){i=i||0;for(var r=0;r<16;++r)a[i+r]=e[r];return a}return function y(o,a=0){return(c[o[a+0]]+c[o[a+1]]+c[o[a+2]]+c[o[a+3]]+"-"+c[o[a+4]]+c[o[a+5]]+"-"+c[o[a+6]]+c[o[a+7]]+"-"+c[o[a+8]]+c[o[a+9]]+"-"+c[o[a+10]]+c[o[a+11]]+c[o[a+12]]+c[o[a+13]]+c[o[a+14]]+c[o[a+15]]).toLowerCase()}(e)};var t=u(3953),O=u(6661);function x(o,a){if(1&o){const i=t.RV6();t.j41(0,"ion-item",25),t.bIt("click",function(){const r=t.eBV(i).$implicit,n=t.XpG(2).index,l=t.XpG();return t.Njj(l.selectItem(n,r))}),t.EFF(1),t.nI1(2,"currency"),t.k0s()}if(2&o){const i=a.$implicit;t.R7$(),t.Lme(" ",i.item_name," ",t.i5U(2,2,i.item_price,"INR")," ")}}function N(o,a){if(1&o&&(t.j41(0,"ion-list",23),t.DNE(1,x,3,5,"ion-item",24),t.k0s()),2&o){const i=t.XpG().index,e=t.XpG();t.R7$(),t.Y8G("ngForOf",e.filteredItems[i])}}function A(o,a){if(1&o){const i=t.RV6();t.j41(0,"ion-item",11)(1,"ion-label",3),t.EFF(2,"Select Item"),t.k0s(),t.j41(3,"ion-input",12),t.bIt("ionInput",function(r){const n=t.eBV(i).index,l=t.XpG();return t.Njj(l.onItemInput(n,r))}),t.k0s(),t.DNE(4,N,2,1,"ion-list",13),t.j41(5,"ion-grid")(6,"ion-row")(7,"ion-col",14)(8,"ion-item")(9,"ion-label",3),t.EFF(10,"Price"),t.k0s(),t.nrm(11,"ion-input",15),t.k0s()(),t.j41(12,"ion-col")(13,"div",14)(14,"ion-item")(15,"ion-buttons",16)(16,"ion-button",1),t.bIt("click",function(){const r=t.eBV(i).index,n=t.XpG();return t.Njj(n.decreaseQuantity(r))}),t.nrm(17,"ion-icon",17),t.k0s()(),t.nrm(18,"ion-input",18),t.j41(19,"ion-buttons",0)(20,"ion-button",1),t.bIt("click",function(){const r=t.eBV(i).index,n=t.XpG();return t.Njj(n.increaseQuantity(r))}),t.nrm(21,"ion-icon",19),t.k0s()()()()(),t.j41(22,"ion-col",20)(23,"ion-item")(24,"ion-label",21),t.EFF(25,"Total:"),t.k0s(),t.j41(26,"ion-label"),t.EFF(27),t.nI1(28,"currency"),t.k0s()()()()(),t.j41(29,"ion-button",22),t.bIt("click",function(){const r=t.eBV(i).index,n=t.XpG();return t.Njj(n.removeItem(r))}),t.EFF(30,"Remove"),t.k0s()()}if(2&o){const i=a.index,e=t.XpG();t.Y8G("formGroupName",i),t.R7$(4),t.Y8G("ngIf",e.filteredItems[i].length>0),t.R7$(23),t.JRh(t.i5U(28,3,e.getItemTotalPrice(i),"INR"))}}let G=(()=>{var o;class a{constructor(e,r){this.modalCtrl=e,this.loaderService=r,this.itemList=[],this.totalPriceBeforeDiscount=0,this.totalPriceAfterDiscount=0,this.filteredItems=[],this.orderForm=new d.gE({customer_Name:new d.MJ("New Customer",[d.k0.required]),items:new d.Yp([],d.k0.required),notes:new d.MJ(""),discount:new d.MJ(0,[d.k0.min(0),d.k0.max(100)])})}ngOnInit(){console.log(this.dataToEdit),this.dataToEdit?(this.orderForm.patchValue({customer_Name:this.dataToEdit.order_Data.customer_Name||"",notes:this.dataToEdit.order_Data.notes||"",discount:this.dataToEdit.order_Data.discount||0}),this.dataToEdit.order_Data.items&&this.dataToEdit.order_Data.items.length>0&&this.dataToEdit.order_Data.items.forEach(e=>{this.addItemWithValues(e)})):this.addItem(),this.filteredItems=this.items.controls.map(()=>[]),this.orderForm.valueChanges.subscribe(()=>{this.calculateTotalPrice()})}get items(){return this.orderForm.get("items")}addItem(){const e=new d.gE({item_name:new d.MJ("",[d.k0.required]),item_price:new d.MJ(0,[d.k0.required,d.k0.min(0)]),quantity:new d.MJ(1,[d.k0.required,d.k0.min(1)])});this.items.push(e),this.filteredItems.push([])}addItemWithValues(e){const r=new d.gE({item_name:new d.MJ(e.item_name,[d.k0.required]),item_price:new d.MJ(e.item_price,[d.k0.required,d.k0.min(0)]),quantity:new d.MJ(e.quantity,[d.k0.required,d.k0.min(1)])});this.items.push(r),this.filteredItems.push([]),this.calculateTotalPrice()}removeItem(e){this.items.removeAt(e),this.filteredItems.splice(e,1),this.calculateTotalPrice()}calculateTotalPrice(){var e;this.totalPriceBeforeDiscount=this.items.value.reduce((l,m)=>l+m.item_price*m.quantity,0);const n=(null===(e=this.orderForm.get("discount"))||void 0===e?void 0:e.value)||0;this.totalPriceAfterDiscount=this.totalPriceBeforeDiscount*(1-n/100)}onItemInput(e,r){const n=r.target.value.toLowerCase();this.filteredItems[e]=n?this.itemList.filter(l=>l.item_name.toLowerCase().includes(n)):[]}selectItem(e,r){var n,l;null===(n=this.items.at(e).get("item_name"))||void 0===n||n.setValue(r.item_name),null===(l=this.items.at(e).get("item_price"))||void 0===l||l.setValue(r.item_price),this.filteredItems[e]=[],this.calculateTotalPrice()}cancel(){return this.modalCtrl.dismiss(null,"cancel")}onSubmit(){if(this.calculateTotalPrice(),this.orderForm.valid){const e=this.orderForm.value;let r={};this.dataToEdit?(r={_id:this.dataToEdit._id,order_Data:e,id:this.dataToEdit.id,total_Price_BeforeDiscount:this.totalPriceBeforeDiscount,total_Price_AfterDiscount:this.totalPriceAfterDiscount,created_At:this.dataToEdit.created_At,updated_At:new Date},console.log("updatedData",r),this.modalCtrl.dismiss(r,"updated_Order")):(r={order_Data:e,id:j(),total_Price_BeforeDiscount:this.totalPriceBeforeDiscount,total_Price_AfterDiscount:this.totalPriceAfterDiscount,created_At:new Date},console.log("newOrderData",r),this.modalCtrl.dismiss(r,"new_Order"))}else console.log("Form is invalid")}decreaseQuantity(e){var r;const n=null===(r=this.items.at(e).get("quantity"))||void 0===r?void 0:r.value;var l;n>1&&(null===(l=this.items.at(e).get("quantity"))||void 0===l||l.setValue(n-1),this.calculateTotalPrice())}increaseQuantity(e){var r,n;const l=null===(r=this.items.at(e).get("quantity"))||void 0===r?void 0:r.value;null===(n=this.items.at(e).get("quantity"))||void 0===n||n.setValue(l+1),this.calculateTotalPrice()}getItemTotalPrice(e){const r=this.items.at(e).value;return r.item_price*r.quantity}}return(o=a).\u0275fac=function(e){return new(e||o)(t.rXU(s.W3),t.rXU(O.f))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-order-form"]],inputs:{itemList:"itemList",dataToEdit:"dataToEdit"},decls:40,vars:11,consts:[["slot","end"],["color","medium",3,"click"],[3,"ngSubmit","formGroup"],["position","floating"],["formControlName","customer_Name","type","text"],["formArrayName","items"],[3,"formGroupName",4,"ngFor","ngForOf"],["expand","full",3,"click"],["formControlName","discount","type","number"],["formControlName","notes"],["expand","full","type","submit",3,"disabled"],[3,"formGroupName"],["formControlName","item_name","type","text",1,"item-name",3,"ionInput"],["class","dropdown",4,"ngIf"],["size","4"],["formControlName","item_price","type","number","readonly",""],["slot","start"],["name","remove-circle-outline"],["formControlName","quantity","type","number","min","1",2,"text-align","center"],["name","add-circle-outline"],["size","6"],["position","floating",2,"margin-bottom","10%"],["color","danger",3,"click"],[1,"dropdown"],[3,"click",4,"ngFor","ngForOf"],[3,"click"]],template:function(e,r){1&e&&(t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),t.bIt("click",function(){return r.cancel()}),t.EFF(4,"Cancel"),t.k0s()(),t.j41(5,"ion-title"),t.EFF(6,"Order Form"),t.k0s()()(),t.j41(7,"ion-content")(8,"form",2),t.bIt("ngSubmit",function(){return r.onSubmit()}),t.j41(9,"ion-item")(10,"ion-label",3),t.EFF(11,"Customer Name"),t.k0s(),t.nrm(12,"ion-input",4),t.k0s(),t.j41(13,"ion-list")(14,"ion-item-group",5),t.DNE(15,A,31,6,"ion-item",6),t.k0s()(),t.j41(16,"ion-button",7),t.bIt("click",function(){return r.addItem()}),t.EFF(17,"Add Another Item"),t.k0s(),t.j41(18,"ion-item")(19,"ion-label",3),t.EFF(20,"Discount (%)"),t.k0s(),t.nrm(21,"ion-input",8),t.k0s(),t.j41(22,"ion-item")(23,"ion-label",3),t.EFF(24,"Notes"),t.k0s(),t.nrm(25,"ion-textarea",9),t.k0s(),t.j41(26,"ion-item")(27,"ion-label"),t.EFF(28,"Total Price (Before Discount):"),t.k0s(),t.j41(29,"ion-label"),t.EFF(30),t.nI1(31,"currency"),t.k0s()(),t.j41(32,"ion-item")(33,"ion-label"),t.EFF(34,"Total Price (After Discount):"),t.k0s(),t.j41(35,"ion-label"),t.EFF(36),t.nI1(37,"currency"),t.k0s()(),t.j41(38,"ion-button",10),t.EFF(39,"Submit Order"),t.k0s()()()),2&e&&(t.R7$(8),t.Y8G("formGroup",r.orderForm),t.R7$(7),t.Y8G("ngForOf",r.items.controls),t.R7$(15),t.JRh(t.i5U(31,5,r.totalPriceBeforeDiscount,"INR")),t.R7$(6),t.JRh(t.i5U(37,8,r.totalPriceAfterDiscount,"INR")),t.R7$(2),t.Y8G("disabled",r.orderForm.invalid))},dependencies:[s.Jm,s.QW,s.hU,s.W9,s.lO,s.eU,s.iq,s.$w,s.uz,s.jh,s.he,s.nf,s.ln,s.nc,s.BC,s.ai,s.su,s.Gw,s.T6,_.Sq,_.bT,d.qT,d.BC,d.cb,d.j4,d.JD,d.$R,d.v8,_.oe],styles:[".item-name[_ngcontent-%COMP%]{border:rgba(0,0,0,.13) 1px solid;margin-top:1%;padding-left:1%}.dropdown[_ngcontent-%COMP%]{position:absolute;top:32%;background-color:#fff;border:1px solid #ccc;z-index:1000;max-height:200px;overflow-y:auto;width:100%;box-shadow:0 2px 10px #0000001a}.dropdown[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{cursor:pointer}.dropdown[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}"]}),a})();var D=u(5312),R=u(8472);function L(o,a){if(1&o){const i=t.RV6();t.j41(0,"ion-card")(1,"ion-card-header",1)(2,"div",2)(3,"ion-item",3),t.EFF(4),t.k0s(),t.j41(5,"ion-buttons",4)(6,"ion-button",5),t.bIt("click",function(){t.eBV(i);const r=t.XpG();return t.Njj(r.deleteOrder(r.orderData))}),t.nrm(7,"ion-icon",6),t.k0s()()()(),t.j41(8,"ion-card-content",7),t.bIt("click",function(){t.eBV(i);const r=t.XpG();return t.Njj(r.orderClicked("clicked",r.orderData))}),t.j41(9,"ion-grid")(10,"ion-row")(11,"ion-col")(12,"ion-label")(13,"strong"),t.EFF(14,"Customer Name:"),t.k0s()(),t.j41(15,"ion-label")(16,"strong"),t.EFF(17),t.k0s()()(),t.j41(18,"ion-col")(19,"ion-label")(20,"strong"),t.EFF(21,"Total Price:"),t.k0s()(),t.j41(22,"ion-label")(23,"strong"),t.EFF(24),t.nI1(25,"currency"),t.k0s()()()()()()()}if(2&o){const i=t.XpG();t.R7$(4),t.SpI("#",i.totalOrders-i.index,""),t.R7$(13),t.JRh(i.orderData.order_Data.customer_Name),t.R7$(7),t.JRh(t.i5U(25,3,i.orderData.total_Price_AfterDiscount,"INR"))}}let S=(()=>{var o;class a{constructor(){this.totalOrders=0,this.dataEvent=new t.bkB,this.deleteEvent=new t.bkB}ngOnInit(){}orderClicked(e,r){this.dataEvent.emit({arg1:e,arg2:r})}deleteOrder(e){const r={arg1:e};console.log("Delete button clicked"),this.deleteEvent.emit(r)}}return(o=a).\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.VBU({type:o,selectors:[["app-order-details-card"]],inputs:{totalOrders:"totalOrders",orderData:"orderData",index:"index"},outputs:{dataEvent:"dataEvent",deleteEvent:"deleteEvent"},decls:1,vars:1,consts:[[4,"ngIf"],[2,"padding","0"],[2,"display","flex","place-content","space-between"],["slot","start","lines","none"],["slot","end"],["color","danger","fill","clear",3,"click"],["name","trash"],[3,"click"]],template:function(e,r){1&e&&t.DNE(0,L,26,6,"ion-card",0),2&e&&t.Y8G("ngIf",r.orderData)},dependencies:[s.Jm,s.QW,s.b_,s.I9,s.ME,s.hU,s.lO,s.iq,s.uz,s.he,s.ln,_.bT,_.oe]}),a})();function M(o,a){if(1&o){const i=t.RV6();t.j41(0,"app-order-details-card",8),t.bIt("dataEvent",function(r){t.eBV(i);const n=t.XpG(2);return t.Njj(n.editOrder(r))})("deleteEvent",function(r){t.eBV(i);const n=t.XpG(2);return t.Njj(n.confirmDelete(r))}),t.k0s()}if(2&o){const i=a.$implicit,e=a.index,r=t.XpG(2);t.Y8G("orderData",i)("totalOrders",r.orderList.length)("index",e)}}function U(o,a){if(1&o&&(t.qex(0),t.j41(1,"div",6),t.DNE(2,M,1,3,"app-order-details-card",7),t.k0s(),t.bVm()),2&o){const i=t.XpG();t.R7$(2),t.Y8G("ngForOf",i.orderList)}}function V(o,a){1&o&&t.EFF(0," No Orders for Today Start Adding Orders ")}const $=[{path:"",component:(()=>{var o;class a{constructor(e,r,n,l){this.modalCtrl=e,this.authService=r,this.alertCtrl=n,this.loaderService=l,this.env=D.c.production,this.itemList=[],this.orderList=[],this.allOrdersData=[],this.app=new I.qw({id:D.c.APP_ID})}ngOnInit(){return(0,p.A)(function*(){})()}ionViewWillEnter(){var e=this;return(0,p.A)(function*(){e.user=yield e.authService.user,console.log(e.user),e.user&&e.getItems()})()}getItems(){var e=this;return(0,p.A)(function*(){e.loaderService.showLoader(),console.assert(e.user.id===e.app.currentUser.id),e.itemList=yield e.user.functions.getItemsData();let r=yield e.user.functions.getOrdersData();e.allOrdersData=r.result,yield e.getOrdersData(),e.sortOrderList(),e.totalDayWise(),console.log(e.itemList),e.loaderService.stopLoader()})()}sortOrderList(){this.orderList.sort((e,r)=>new Date(r.created_At).getTime()-new Date(e.created_At).getTime())}getOrdersData(){var e=this;return(0,p.A)(function*(){let r=yield e.user.functions.getTodaysOrdersData(new Date);e.orderList=r.result,console.log("todaysOrders",r)})()}openModal(e){var r=this;return(0,p.A)(function*(){const n=yield r.modalCtrl.create({component:G,initialBreakpoint:1,breakpoints:[.25,.5,.75,1],componentProps:{itemList:r.itemList.result,dataToEdit:e}});n.present();const l=yield n.onWillDismiss();if("new_Order"===l.role){r.loaderService.showLoader(),console.log(l.data);let m=yield r.user.functions.insertOrdersData(l.data);console.log(m),m.success&&(r.orderList.push(l.data),yield r.getOrdersData(),r.sortOrderList(),r.totalDayWise())}if("updated_Order"===l.role){r.loaderService.showLoader(),console.log(l.data);const m={_id:l.data._id.toString()};let F=yield r.user.functions.updateSingleOrder(m,l.data);if(console.log("Order Updated",F),F.status){const T=l.data,k=r.orderList.findIndex(J=>J.id===T.id);-1!==k&&(r.orderList[k]=T),console.log("updated OrderList",r.orderList),r.sortOrderList(),r.totalDayWise()}}r.loaderService.stopLoader()})()}totalDayWise(){const e=new Map;this.allOrdersData.forEach(n=>{const m=new Date(n.created_At).toISOString().split("T")[0];e.has(m)?e.set(m,e.get(m)+n.total_Price_AfterDiscount):e.set(m,n.total_Price_AfterDiscount)});const r=Array.from(e.entries()).map(([n,l])=>({day:n,earning:l}));console.log(r),localStorage.setItem("Earning_History",JSON.stringify(r))}logout(){this.authService.logout()}editOrder(e){"clicked"==e.arg1&&this.openModal(e.arg2)}confirmDelete(e){var r=this;return(0,p.A)(function*(){yield(yield r.alertCtrl.create({header:"Confirm Delete",message:"Are you sure you want to delete this Order?",buttons:[{text:"Cancel",role:"cancel"},{text:"Delete",handler:()=>{r.deleteOrder(e)}}]})).present()})()}deleteOrder(e){var r=this;return(0,p.A)(function*(){r.loaderService.showLoader(),console.log(e);const n={_id:e.arg1._id.toString()};console.log(n);const l=yield r.user.functions.deleteSingleOrder(n);console.log(l),l.status?(r.loaderService.stopLoader(!0),r.showAlert("Success","Order deleted successfully."),r.orderList=r.orderList.filter(m=>m.id!==e.arg1.id)):(r.loaderService.stopLoader(!0),r.showAlert("Error",l.message))})()}showAlert(e,r){var n=this;return(0,p.A)(function*(){yield(yield n.alertCtrl.create({header:e,message:r,buttons:["OK"]})).present()})()}}return(o=a).\u0275fac=function(e){return new(e||o)(t.rXU(s.W3),t.rXU(R.u),t.rXU(s.hG),t.rXU(O.f))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-tab1"]],decls:7,vars:3,consts:[["noOrders",""],[3,"fullscreen"],[4,"ngIf","ngIfElse"],["vertical","bottom","horizontal","end","slot","fixed"],["color","primary",3,"click"],["name","add"],[1,"layout"],[3,"orderData","totalOrders","index","dataEvent","deleteEvent",4,"ngFor","ngForOf"],[3,"dataEvent","deleteEvent","orderData","totalOrders","index"]],template:function(e,r){if(1&e){const n=t.RV6();t.j41(0,"ion-content",1),t.DNE(1,U,3,1,"ng-container",2)(2,V,1,0,"ng-template",null,0,t.C5r),t.k0s(),t.j41(4,"ion-fab",3)(5,"ion-fab-button",4),t.bIt("click",function(){return t.eBV(n),t.Njj(r.openModal(null))}),t.nrm(6,"ion-icon",5),t.k0s()()}if(2&e){const n=t.sdS(3);t.Y8G("fullscreen",!0),t.R7$(),t.Y8G("ngIf",r.orderList.length>0)("ngIfElse",n)}},dependencies:[s.W9,s.Q8,s.YW,s.iq,_.Sq,_.bT,S],styles:[".layout[_ngcontent-%COMP%]{margin-top:19%}@media (min-width: 470px){.layout[_ngcontent-%COMP%]{margin-top:13%}}@media (min-width: 576px){.layout[_ngcontent-%COMP%]{margin-top:11%}}@media (min-width: 860px){.layout[_ngcontent-%COMP%]{margin-top:8%}}@media (min-width: 1024px){.layout[_ngcontent-%COMP%]{margin-top:6%}}"]}),a})()}];let B=(()=>{var o;class a{}return(o=a).\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=t.G2t({imports:[v.iI.forChild($),v.iI]}),a})(),X=(()=>{var o;class a{}return(o=a).\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=t.G2t({imports:[s.bv,_.MD,d.YN,B,d.X1]}),a})()}}]);