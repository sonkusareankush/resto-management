"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3827],{3827:(x,h,m)=>{m.r(h),m.d(h,{Tab1PageModule:()=>V});var c=m(4742),p=m(177),a=m(4341),D=m(70),_=m(467),F=m(156);const b={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};var f,O=new Uint8Array(16);function C(){if(!f&&!(f=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return f(O)}for(var l=[],g=0;g<256;++g)l.push((g+256).toString(16).slice(1));const j=function I(o,i,n){if(b.randomUUID&&!i&&!o)return b.randomUUID();var e=(o=o||{}).random||(o.rng||C)();if(e[6]=15&e[6]|64,e[8]=63&e[8]|128,i){n=n||0;for(var r=0;r<16;++r)i[n+r]=e[r];return i}return function v(o,i=0){return(l[o[i+0]]+l[o[i+1]]+l[o[i+2]]+l[o[i+3]]+"-"+l[o[i+4]]+l[o[i+5]]+"-"+l[o[i+6]]+l[o[i+7]]+"-"+l[o[i+8]]+l[o[i+9]]+"-"+l[o[i+10]]+l[o[i+11]]+l[o[i+12]]+l[o[i+13]]+l[o[i+14]]+l[o[i+15]]).toLowerCase()}(e)};var t=m(3953);function N(o,i){if(1&o&&(t.j41(0,"ion-select-option",18),t.EFF(1),t.nI1(2,"currency"),t.k0s()),2&o){const n=i.$implicit;t.Y8G("value",n.item_name),t.R7$(),t.Lme(" ",n.item_name," ",t.i5U(2,3,n.item_price,"INR")," ")}}function A(o,i){if(1&o){const n=t.RV6();t.j41(0,"ion-item",12)(1,"ion-label",4),t.EFF(2,"Select Item"),t.k0s(),t.j41(3,"ion-select",13),t.bIt("ionChange",function(){const r=t.eBV(n).index,s=t.XpG();return t.Njj(s.onItemSelected(r))}),t.DNE(4,N,3,6,"ion-select-option",14),t.k0s(),t.j41(5,"ion-label",4),t.EFF(6,"Price"),t.k0s(),t.nrm(7,"ion-input",15),t.j41(8,"ion-label",4),t.EFF(9,"Quantity"),t.k0s(),t.nrm(10,"ion-input",16),t.j41(11,"ion-button",17),t.bIt("click",function(){const r=t.eBV(n).index,s=t.XpG();return t.Njj(s.removeItem(r))}),t.EFF(12,"Remove"),t.k0s()()}if(2&o){const n=i.index,e=t.XpG();t.Y8G("formGroupName",n),t.R7$(4),t.Y8G("ngForOf",e.itemList)}}let R=(()=>{var o;class i{constructor(e){this.modalCtrl=e,this.itemList=[],this.totalPriceBeforeDiscount=0,this.totalPriceAfterDiscount=0,this.orderForm=new a.gE({customer_Name:new a.MJ("New Customer",[a.k0.required]),items:new a.Yp([]),notes:new a.MJ(""),discount:new a.MJ(0,[a.k0.min(0),a.k0.max(100)])})}ngOnInit(){console.log(this.dataToEdit),this.dataToEdit?(this.orderForm.patchValue({customer_Name:this.dataToEdit.order_Data.customer_Name||"",notes:this.dataToEdit.order_Data.notes||"",discount:this.dataToEdit.order_Data.discount||0}),this.dataToEdit.order_Data.items&&this.dataToEdit.order_Data.items.length>0&&this.dataToEdit.order_Data.items.forEach(e=>{this.addItemWithValues(e)})):this.addItem(),this.orderForm.valueChanges.subscribe(()=>{this.calculateTotalPrice()})}get items(){return this.orderForm.get("items")}addItem(){const e=new a.gE({item_name:new a.MJ("",[a.k0.required]),item_price:new a.MJ(0,[a.k0.required,a.k0.min(0)]),quantity:new a.MJ(1,[a.k0.required,a.k0.min(1)])});this.items.push(e)}addItemWithValues(e){const r=new a.gE({item_name:new a.MJ(e.item_name,[a.k0.required]),item_price:new a.MJ(e.item_price,[a.k0.required,a.k0.min(0)]),quantity:new a.MJ(e.quantity,[a.k0.required,a.k0.min(1)])});this.items.push(r),this.calculateTotalPrice()}removeItem(e){this.items.removeAt(e),this.calculateTotalPrice()}calculateTotalPrice(){var e;this.totalPriceBeforeDiscount=this.items.value.reduce((d,u)=>d+u.item_price*u.quantity,0);const s=(null===(e=this.orderForm.get("discount"))||void 0===e?void 0:e.value)||0;this.totalPriceAfterDiscount=this.totalPriceBeforeDiscount*(1-s/100)}onItemSelected(e){const r=this.itemList.find(d=>{var u;return d.item_name===(null===(u=this.items.at(e).get("item_name"))||void 0===u?void 0:u.value)});var s;r&&(null===(s=this.items.at(e).get("item_price"))||void 0===s||s.setValue(r.item_price),this.calculateTotalPrice())}cancel(){return this.modalCtrl.dismiss(null,"cancel")}onSubmit(){if(this.calculateTotalPrice(),this.orderForm.valid){const e=this.orderForm.value;let r={};this.dataToEdit?(r={_id:this.dataToEdit._id,order_Data:e,id:this.dataToEdit.id,total_Price_BeforeDiscount:this.totalPriceBeforeDiscount,total_Price_AfterDiscount:this.totalPriceAfterDiscount,created_At:this.dataToEdit.created_At,updated_At:new Date},console.log("updatedData",r),this.modalCtrl.dismiss(r,"updated_Order")):(r={order_Data:e,id:j(),total_Price_BeforeDiscount:this.totalPriceBeforeDiscount,total_Price_AfterDiscount:this.totalPriceAfterDiscount,created_At:new Date},console.log("newOrderData",r),this.modalCtrl.dismiss(r,"new_Order"))}else console.log("Form is invalid")}}return(o=i).\u0275fac=function(e){return new(e||o)(t.rXU(c.W3))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-order-form"]],inputs:{itemList:"itemList",dataToEdit:"dataToEdit"},decls:40,vars:11,consts:[["slot","end"],["color","medium",3,"click"],[2,"text-align","center"],[3,"ngSubmit","formGroup"],["position","floating"],["formControlName","customer_Name","type","text"],["formArrayName","items"],[3,"formGroupName",4,"ngFor","ngForOf"],["expand","full",3,"click"],["formControlName","discount","type","number"],["formControlName","notes"],["expand","full","type","submit",3,"disabled"],[3,"formGroupName"],["formControlName","item_name",3,"ionChange"],[3,"value",4,"ngFor","ngForOf"],["formControlName","item_price","type","number","readonly",""],["formControlName","quantity","type","number"],["color","danger",3,"click"],[3,"value"]],template:function(e,r){1&e&&(t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),t.bIt("click",function(){return r.cancel()}),t.EFF(4,"Cancel"),t.k0s()(),t.j41(5,"ion-title",2),t.EFF(6,"Order Form"),t.k0s()()(),t.j41(7,"ion-content")(8,"form",3),t.bIt("ngSubmit",function(){return r.onSubmit()}),t.j41(9,"ion-item")(10,"ion-label",4),t.EFF(11,"Customer Name"),t.k0s(),t.nrm(12,"ion-input",5),t.k0s(),t.j41(13,"ion-list")(14,"ion-item-group",6),t.DNE(15,A,13,2,"ion-item",7),t.k0s()(),t.j41(16,"ion-button",8),t.bIt("click",function(){return r.addItem()}),t.EFF(17,"Add Another Item"),t.k0s(),t.j41(18,"ion-item")(19,"ion-label",4),t.EFF(20,"Discount (%)"),t.k0s(),t.nrm(21,"ion-input",9),t.k0s(),t.j41(22,"ion-item")(23,"ion-label",4),t.EFF(24,"Notes"),t.k0s(),t.nrm(25,"ion-textarea",10),t.k0s(),t.j41(26,"ion-item")(27,"ion-label"),t.EFF(28,"Total Price (Before Discount):"),t.k0s(),t.j41(29,"ion-label"),t.EFF(30),t.nI1(31,"currency"),t.k0s()(),t.j41(32,"ion-item")(33,"ion-label"),t.EFF(34,"Total Price (After Discount):"),t.k0s(),t.j41(35,"ion-label"),t.EFF(36),t.nI1(37,"currency"),t.k0s()(),t.j41(38,"ion-button",11),t.EFF(39,"Submit Order"),t.k0s()()()),2&e&&(t.R7$(8),t.Y8G("formGroup",r.orderForm),t.R7$(7),t.Y8G("ngForOf",r.items.controls),t.R7$(15),t.JRh(t.i5U(31,5,r.totalPriceBeforeDiscount,"INR")),t.R7$(6),t.JRh(t.i5U(37,8,r.totalPriceAfterDiscount,"INR")),t.R7$(2),t.Y8G("disabled",r.orderForm.invalid))},dependencies:[c.Jm,c.QW,c.W9,c.eU,c.$w,c.uz,c.jh,c.he,c.nf,c.Nm,c.Ip,c.nc,c.BC,c.ai,c.su,c.Je,c.Gw,p.Sq,a.qT,a.BC,a.cb,a.j4,a.JD,a.$R,a.v8,p.oe]}),i})();var y=m(5312),w=m(8472);function B(o,i){if(1&o){const n=t.RV6();t.j41(0,"ion-card")(1,"ion-card-content",1),t.bIt("click",function(){t.eBV(n);const r=t.XpG();return t.Njj(r.orderClicked("clicked",r.orderData))}),t.j41(2,"ion-item")(3,"ion-label")(4,"strong"),t.EFF(5,"Customer Name:"),t.k0s()(),t.j41(6,"ion-label"),t.EFF(7),t.k0s()(),t.j41(8,"ion-item")(9,"ion-label")(10,"strong"),t.EFF(11,"Total Price (Before Discount):"),t.k0s()(),t.j41(12,"ion-label"),t.EFF(13),t.nI1(14,"currency"),t.k0s()(),t.j41(15,"ion-item")(16,"ion-label")(17,"strong"),t.EFF(18,"Total Price (After Discount):"),t.k0s()(),t.j41(19,"ion-label"),t.EFF(20),t.nI1(21,"currency"),t.k0s()(),t.j41(22,"ion-item")(23,"ion-label")(24,"strong"),t.EFF(25,"Discount Applied:"),t.k0s()(),t.j41(26,"ion-label"),t.EFF(27),t.k0s()()()()}if(2&o){const n=t.XpG();t.R7$(7),t.JRh(n.customerName),t.R7$(6),t.JRh(t.i5U(14,4,n.totalPriceBeforeDiscount,"INR")),t.R7$(7),t.JRh(t.i5U(21,7,n.totalPriceAfterDiscount,"INR")),t.R7$(7),t.SpI("",n.discount,"%")}}let G=(()=>{var o;class i{constructor(){this.customerName="",this.totalPriceBeforeDiscount=0,this.totalPriceAfterDiscount=0,this.discount=0,this.dataEvent=new t.bkB}ngOnInit(){}orderClicked(e,r){this.dataEvent.emit({arg1:e,arg2:r})}}return(o=i).\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.VBU({type:o,selectors:[["app-order-details-card"]],inputs:{customerName:"customerName",totalPriceBeforeDiscount:"totalPriceBeforeDiscount",totalPriceAfterDiscount:"totalPriceAfterDiscount",discount:"discount",orderData:"orderData"},outputs:{dataEvent:"dataEvent"},decls:1,vars:1,consts:[[4,"ngIf"],[3,"click"]],template:function(e,r){1&e&&t.DNE(0,B,28,10,"ion-card",0),2&e&&t.Y8G("ngIf",r.customerName)},dependencies:[c.b_,c.I9,c.uz,c.he,p.bT,p.oe]}),i})();function L(o,i){if(1&o){const n=t.RV6();t.j41(0,"app-order-details-card",6),t.bIt("dataEvent",function(r){t.eBV(n);const s=t.XpG(2);return t.Njj(s.editOrder(r))}),t.k0s()}if(2&o){const n=i.$implicit;t.Y8G("orderData",n)("customerName",n.order_Data.customer_Name)("totalPriceBeforeDiscount",n.total_Price_BeforeDiscount)("totalPriceAfterDiscount",n.total_Price_AfterDiscount)("discount",n.order_Data.discount)}}function U(o,i){if(1&o&&(t.qex(0),t.DNE(1,L,1,5,"app-order-details-card",5),t.bVm()),2&o){const n=t.XpG();t.R7$(),t.Y8G("ngForOf",n.orderList)}}const S=[{path:"",component:(()=>{var o;class i{constructor(e,r){this.modalCtrl=e,this.authService=r,this.env=y.c.production,this.itemList=[],this.orderList=[],this.allOrdersData=[],this.app=new F.qw({id:y.c.APP_ID}),this.credentials=F.Ji.anonymous()}ngOnInit(){return(0,_.A)(function*(){})()}ionViewWillEnter(){var e=this;return(0,_.A)(function*(){e.user=yield e.authService.user,console.log(e.user),e.user&&e.getItems()})()}getItems(){var e=this;return(0,_.A)(function*(){console.assert(e.user.id===e.app.currentUser.id),e.itemList=yield e.user.functions.getItemsData();let r=yield e.user.functions.getOrdersData();e.allOrdersData=r.result;let s=yield e.user.functions.getTodaysOrdersData(new Date);e.orderList=s.result,console.log("todaysOrders",s),e.sortOrderList(),e.totalDayWise(),console.log(e.itemList)})()}sortOrderList(){this.orderList.sort((e,r)=>new Date(r.created_At).getTime()-new Date(e.created_At).getTime())}getOrdersData(){var e=this;return(0,_.A)(function*(){let r=yield e.user.functions.getOrdersData();e.orderList=r.result,console.log(e.orderList)})()}openModal(e){var r=this;return(0,_.A)(function*(){const s=yield r.modalCtrl.create({component:R,initialBreakpoint:1,breakpoints:[.25,.5,.75,1],componentProps:{itemList:r.itemList.result,dataToEdit:e}});s.present();const d=yield s.onWillDismiss();if("new_Order"===d.role){console.log(d.data);let u=yield r.user.functions.insertOrdersData(d.data);console.log(u),u.success&&(r.orderList.push(d.data),r.sortOrderList(),r.totalDayWise())}if("updated_Order"===d.role){console.log(d.data);const u={_id:d.data._id.toString()};let T=yield r.user.functions.updateSingleOrder(u,d.data);if(console.log("Order Updated",T),T.status){const P=d.data,k=r.orderList.findIndex(J=>J.id===P.id);-1!==k&&(r.orderList[k]=P),console.log("updated OrderList",r.orderList),r.sortOrderList(),r.totalDayWise()}}})()}totalDayWise(){const e=new Map;this.allOrdersData.forEach(s=>{const u=new Date(s.created_At).toISOString().split("T")[0];e.has(u)?e.set(u,e.get(u)+s.total_Price_AfterDiscount):e.set(u,s.total_Price_AfterDiscount)});const r=Array.from(e.entries()).map(([s,d])=>({day:s,earning:d}));console.log(r),localStorage.setItem("Earning_History",JSON.stringify(r))}logout(){this.authService.logout()}editOrder(e){"clicked"==e.arg1&&this.openModal(e.arg2)}}return(o=i).\u0275fac=function(e){return new(e||o)(t.rXU(c.W3),t.rXU(w.u))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-tab1"]],decls:5,vars:2,consts:[[2,"top","10%",3,"fullscreen"],[4,"ngIf"],["vertical","bottom","horizontal","end","slot","fixed"],["color","primary",3,"click"],["name","add"],[3,"orderData","customerName","totalPriceBeforeDiscount","totalPriceAfterDiscount","discount","dataEvent",4,"ngFor","ngForOf"],[3,"dataEvent","orderData","customerName","totalPriceBeforeDiscount","totalPriceAfterDiscount","discount"]],template:function(e,r){1&e&&(t.j41(0,"ion-content",0),t.DNE(1,U,2,1,"ng-container",1),t.k0s(),t.j41(2,"ion-fab",2)(3,"ion-fab-button",3),t.bIt("click",function(){return r.openModal(null)}),t.nrm(4,"ion-icon",4),t.k0s()()),2&e&&(t.Y8G("fullscreen",!0),t.R7$(),t.Y8G("ngIf",r.orderList.length>0))},dependencies:[c.W9,c.Q8,c.YW,c.iq,p.Sq,p.bT,G]}),i})()}];let M=(()=>{var o;class i{}return(o=i).\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=t.G2t({imports:[D.iI.forChild(S),D.iI]}),i})(),V=(()=>{var o;class i{}return(o=i).\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=t.G2t({imports:[c.bv,p.MD,a.YN,M,a.X1]}),i})()}}]);